<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.bravomylife.backoffice.mybatis.statistics.Member">

	<select id="memberAge" resultType="memberAgeDto">
	<![CDATA[
		SELECT
			gender,
			ageGroup,
			SUM(countAge) AS sumAge
		FROM (
			SELECT
				gender,
				CASE
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 10 AND 19 THEN '10대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 20 AND 29 THEN '20대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 30 AND 39 THEN '30대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 40 AND 49 THEN '40대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 50 AND 59 THEN '50대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 60 AND 69 THEN '60대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 70 AND 79 THEN '70대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 80 AND 89 THEN '80대'
					ELSE '기타'
				END AS ageGroup,
				COUNT(*) AS countAge
			FROM TB_MBR_MST
			GROUP BY gender,
				CASE
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 10 AND 19 THEN '10대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 20 AND 29 THEN '20대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 30 AND 39 THEN '30대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 40 AND 49 THEN '40대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 50 AND 59 THEN '50대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 60 AND 69 THEN '60대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 70 AND 79 THEN '70대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 80 AND 89 THEN '80대'
					ELSE '기타'
				END
		) ageData
		GROUP BY gender, ageGroup
	]]>
	</select>

	<select id="sellingBest" resultType="memberAgeDto">
		 SELECT
			TO_CHAR(dt_reg, 'YYYY-MM') AS month,
			SUM(CASE WHEN seq_sle = 335 THEN count ELSE 0 END) AS product1,
			SUM(CASE WHEN seq_sle = 344 THEN count ELSE 0 END) AS product2,
			SUM(CASE WHEN seq_sle = 343 THEN count ELSE 0 END) AS product3,
			SUM(CASE WHEN seq_sle = 336 THEN count ELSE 0 END) AS product4,
			SUM(CASE WHEN seq_sle = 5 THEN count ELSE 0 END) AS product5,
			SUM(CASE WHEN seq_sle = 6 THEN count ELSE 0 END) AS product6,
			SUM(CASE WHEN seq_sle = 7 THEN count ELSE 0 END) AS product7,
			SUM(CASE WHEN seq_sle = 8 THEN count ELSE 0 END) AS product8,
			SUM(CASE WHEN seq_sle = 9 THEN count ELSE 0 END) AS product9,
			SUM(CASE WHEN seq_sle = 10 THEN count ELSE 0 END) AS product10
		FROM
			tb_best
		GROUP BY
			TO_CHAR(dt_reg, 'YYYY-MM')
		ORDER BY
			TO_CHAR(dt_reg, 'YYYY-MM')
	</select>
	
</mapper> 