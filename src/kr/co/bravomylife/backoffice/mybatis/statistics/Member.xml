<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.bravomylife.backoffice.mybatis.statistics.Member">

	<select id="memberAge" resultType="memberAgeDto">
	<![CDATA[
		SELECT
			gender,
			ageGroup,
			SUM(countAge) AS sumAge
		FROM (
			SELECT
				gender,
				CASE
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 10 AND 19 THEN '10대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 20 AND 29 THEN '20대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 30 AND 39 THEN '30대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 40 AND 49 THEN '40대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 50 AND 59 THEN '50대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 60 AND 69 THEN '60대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 70 AND 79 THEN '70대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 80 AND 89 THEN '80대'
					ELSE '기타'
				END AS ageGroup,
				COUNT(*) AS countAge
			FROM TB_MBR_MST
			GROUP BY gender,
				CASE
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 10 AND 19 THEN '10대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 20 AND 29 THEN '20대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 30 AND 39 THEN '30대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 40 AND 49 THEN '40대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 50 AND 59 THEN '50대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 60 AND 69 THEN '60대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 70 AND 79 THEN '70대'
					WHEN TRUNC(MONTHS_BETWEEN(SYSDATE, age) / 12) BETWEEN 80 AND 89 THEN '80대'
					ELSE '기타'
				END
		) ageData
		GROUP BY gender, ageGroup
	]]>
</select>

</mapper> 