<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.bravomylife.front.mybatis.basket.Basket">

	<insert id="insert" parameterType="basketDto">
		INSERT INTO TB_BSK
			(SEQ_BSK, SEQ_MBR, SEQ_SLE, SLE_NM, PRICE, COUNT, IMG, POINT_VALUE, CD_CTG_M, CD_CTG_B, FLG_DELETE, DT_REG)
		VALUES
			(SQ_SEQ_BSK.NEXTVAL, #{seq_mbr}, #{seq_sle}, #{sle_nm}, #{price}, #{count}, #{img}, #{point_value}, #{cd_ctg_m}, #{cd_ctg_b}, 'N', SYSDATE)
	</insert>

	<select id="listingCount" parameterType="pagingDto" resultType="java.lang.Integer">
		SELECT
			COUNT(ROWNUM)
		FROM
			TB_BSK
		WHERE
		<include refid="listingwhere" />
	</select>

	<select id="listingList" parameterType="pagingDto" resultType="basketDto">
		SELECT
			*
		FROM
		(
		SELECT
			/*+ first_rows(10) */ ROW_NUMBER() OVER (ORDER BY DT_REG DESC) rnum
			, SEQ_SLE
			, SLE_NM
			, PRICE
			, COUNT
			, IMG
			, POINT_VALUE
			, CD_CTG_M
			, CD_CTG_B
			, (PRICE * COUNT) TOTAL_PRICE
			, (POINT_VALUE * COUNT) TOTAL_POINT
		FROM
			TB_BSK
		WHERE
		<include refid="listingwhere" />
		)
		<![CDATA[
		WHERE rnum >= (${currentPage} - 1) * ${linePerPage} + 1 AND rnum <= ${currentPage} * ${linePerPage}
		]]>
		ORDER BY rnum
	</select>

	<sql id="listingwhere">
		SEQ_MBR			= #{seq_mbr}
		AND FLG_DELETE	= 'N'
	</sql>

</mapper>